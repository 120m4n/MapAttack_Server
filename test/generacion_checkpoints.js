var wkx = require('wkx');

const FeatureCollection = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.12204772583968,
                7.130102594514383
              ],
              [
                -73.12204772583968,
                7.130007474806121
              ],
              [
                -73.12200938143766,
                7.130007474806121
              ],
              [
                -73.12200938143766,
                7.130102594514383
              ],
              [
                -73.12204772583968,
                7.130102594514383
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.1218885965686,
                7.130161568724603
              ],
              [
                -73.1218885965686,
                7.130091180151567
              ],
              [
                -73.12186942436729,
                7.130091180151567
              ],
              [
                -73.12186942436729,
                7.130161568724603
              ],
              [
                -73.1218885965686,
                7.130161568724603
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.1216374407512,
                7.130136837605647
              ],
              [
                -73.1216374407512,
                7.130079765786874
              ],
              [
                -73.12159909634919,
                7.130079765786874
              ],
              [
                -73.12159909634919,
                7.130136837605647
              ],
              [
                -73.1216374407512,
                7.130136837605647
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.12136902993592,
                7.130226250107597
              ],
              [
                -73.12136902993592,
                7.13015205675552
              ],
              [
                -73.12128658947132,
                7.13015205675552
              ],
              [
                -73.12128658947132,
                7.130226250107597
              ],
              [
                -73.12136902993592,
                7.130226250107597
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.1214303809796,
                7.130515413822621
              ],
              [
                -73.1214303809796,
                7.130446927696582
              ],
              [
                -73.12136136105575,
                7.130446927696582
              ],
              [
                -73.12136136105575,
                7.130515413822621
              ],
              [
                -73.1214303809796,
                7.130515413822621
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.12140353989815,
                7.130774139098108
              ],
              [
                -73.12140353989815,
                7.130724676924714
              ],
              [
                -73.12134794051501,
                7.130724676924714
              ],
              [
                -73.12134794051501,
                7.130774139098108
              ],
              [
                -73.12140353989815,
                7.130774139098108
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.12150898748207,
                7.131013840211551
              ],
              [
                -73.12150898748207,
                7.130956768502045
              ],
              [
                -73.12145147087878,
                7.130956768502045
              ],
              [
                -73.12145147087878,
                7.131013840211551
              ],
              [
                -73.12150898748207,
                7.131013840211551
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.12177548107661,
                7.131006230650343
              ],
              [
                -73.12177548107661,
                7.130966280454501
              ],
              [
                -73.12172179891365,
                7.130966280454501
              ],
              [
                -73.12172179891365,
                7.131006230650343
              ],
              [
                -73.12177548107661,
                7.131006230650343
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.1219384447862,
                7.130928232644607
              ],
              [
                -73.1219384447862,
                7.130886380051194
              ],
              [
                -73.12188667984285,
                7.130886380051194
              ],
              [
                -73.12188667984285,
                7.130928232644607
              ],
              [
                -73.1219384447862,
                7.130928232644607
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.12221835890215,
                7.130930134962185
              ],
              [
                -73.12221835890215,
                7.130884477587301
              ],
              [
                -73.12216659395936,
                7.130884477587301
              ],
              [
                -73.12216659395936,
                7.130930134962185
              ],
              [
                -73.12221835890215,
                7.130930134962185
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.12231997156802,
                7.130747505434115
              ],
              [
                -73.12231997156802,
                7.1306942384746606
              ],
              [
                -73.12225095164416,
                7.1306942384746606
              ],
              [
                -73.12225095164416,
                7.130747505434115
              ],
              [
                -73.12231997156802,
                7.130747505434115
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.12217042839977,
                7.130536339950183
              ],
              [
                -73.12222027612232,
                7.130536339950183
              ],
              [
                -73.12222027612232,
                7.1304925849284615
              ],
              [
                -73.12217042839977,
                7.1304925849284615
              ],
              [
                -73.12217042839977,
                7.130536339950183
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                -73.12221835890215,
                7.130290931293501
              ],
              [
                -73.12221835890215,
                7.130247176248318
              ],
              [
                -73.1221608422988,
                7.130247176248318
              ],
              [
                -73.1221608422988,
                7.130290931293501
              ],
              [
                -73.12221835890215,
                7.130290931293501
              ]
            ]
          ],
          "type": "Polygon"
        }
      }
    ]
  }
//generate a value into [1,13]
function generateRandomValue() {
  return Math.floor(Math.random() * 13) + 1;
}


// function to extract a wkx geometry from a geojson element in a list of objects
function extractWkxGeometry(list_objects) {
  const list_wkx_geometry = [];
  let point = 0;
  for (const object of list_objects) {
    point = point + 1;
    const label = 'check_point_' + point;
    const geometry = wkx.Geometry.parseGeoJSON(object.geometry);
    list_wkx_geometry.push(
      {
        points: generateRandomValue(),
        fenceId: label,
        geoData: geometry.toWkt()
      });
  }
  return list_wkx_geometry;
}


const list_check_points = FeatureCollection.features;

// execute the function
const list_wkx_geometry = extractWkxGeometry(list_check_points);
// console.log(list_wkx_geometry);

// create a post request to http://192.168.1.7:3000/fence/set for each element in the list using axios
const axios = require('axios');
const url = 'http://192.168.1.7:3000/fence/set';
for (const wkx_geometry of list_wkx_geometry) {
  axios.post(url, wkx_geometry)
    .then(function (response) {
      console.log(response.data);
    })
    .catch(function (error) {
      console.log(error);
    });
}